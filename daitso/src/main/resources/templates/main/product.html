<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>카테고리별 상품 리스트</title>
</head>
<div th:replace="~{/include/header :: header}"></div>
<body>
	<div th:replace="~{/include/body-header :: bodyHeader}"></div>
	<div class="product-body">
		<div>
			<img style="width: 100%;" th:src="@{/images/mainImages.png}">		
		</div>
		<div class="product-path-bar">
			<th:block th:if="${categoryId == 'noCategory'}">
				<span style="width:1215px">전체 > [[${path}]]</span>		
			</th:block>
			<th:block th:if="${categoryId != 'noCategory'}">
				<span style="width:1215px">전체 [[${path}]]</span>		
			</th:block>
		</div>
		<div class="d-flex justify-content-center">
			<th:block th:if="${categoryList != 'noCategory'}">
				<div class="product-sidebar">
					<div>
						<div style="width:200px; border: 1px solid #eee">
						<ul>
							<th:block th:each="list : ${categoryList}">
								<p style="margin-left:10px; border-bottom: solid 1px #eee" th:if="${list.lv == 1}">[[${list.categoryNm}]]</p>
								<li th:class="list+${list.categoryId} + ' ' + font-s-13 + ' ' + margin-b-5"  th:if="${list.lv == 2}" style="margin-left:20px">
									<a th:class="a+${list.categoryId}" th:href="@{/category/{id}(id=${list.categoryId})}" style="color: black">[[${list.categoryNm}]] 
										<a th:class="show-btn+${list.categoryId}"  th:onclick="showDownCategory([[${list.categoryId}]], [[${list.lv}]])" th:if="${list.isLeaf == 0}">
											<img style="width:10px" th:src="@{/assets/common/angle-down-solid.svg}"></img>
										</a>
										<a th:class="hidden-btn+${list.categoryId}"  style="display:none" th:onclick="hideDownCategory([[${list.categoryId}]], [[${list.lv}]])" th:if="${list.isLeaf == 0}">
											<img style="width:10px" th:src="@{/assets/common/angle-up-solid.svg}"></img>
										</a>
									</a>
								</li>						
							</th:block>
						</ul>
						</div>	
					</div>
				</div>
			</th:block>
			<div>
				<th:block th:if="${categoryId != 'noCategory'}">
					<div class="d-flex align-items-center" style="height: 40px; margin-top:15px; background-color:#fafafa; font-size:12px">
						<a class="a-sort" th:href="@{'/category/' + ${categoryId} + '?sort=lowPrice'}" style="margin-left: 20px">낮은 가격순</a>
						<span style="margin:0 10px 0 10px"> | </span>
						<a class="a-sort" th:href="@{'/category/' + ${categoryId} + '?sort=highPrice'}">높은 가격순</a>
						<span style="margin:0 10px 0 10px"> | </span>
						<a class="a-sort" th:href="@{'/category/' + ${categoryId} + '?sort=highRate'}">평점순</a>
					</div>				
				</th:block>
				<th:block th:if="${categoryId == 'noCategory'}">
					<div class="d-flex align-items-center" style="height: 40px; margin-top:15px; background-color:#fafafa; font-size:12px">
						<a th:href="@{'/product/search' + '?sort=lowPrice&searchText='+ ${path}}" style="cursor: pointer; margin-left: 20px">낮은 가격순</a>
						<span style="margin:0 10px 0 10px"> | </span>
						<a style="cursor: pointer" th:href="@{'/product/search' + '?sort=highPrice&searchText=' + ${path}}">높은 가격순</a>
						<span style="margin:0 10px 0 10px"> | </span>
						<a style="cursor: pointer" th:href="@{'/product/search' + '?sort=highRate&searchText=' + ${path}}">평점순</a>
					</div>				
				</th:block>
				<div class="product-large-box">
					<th:block th:each="list : ${productList}">
						<div style="width: 212px; height:400px" class="product-box" th:onclick="goProductDetail([[${list.productId}]], [[${list.productGroupId}]])">
							<div style="width: 212px; height: 212px;">
								<img style="width: 100%; height: 100%" th:src="@{/images/mainImages.png}">
							</div>
							<div style="width: 212px;">
								<p class="font-s-13" th:if='${list.discountRate != 0}' style="color:#a50000; font-weight:bold; margin-top:5px; margin-bottom:0px">지금 10% 할인중</p>
								<p style="font-size:13px; margin-bottom: 0px">[[${list.productNm}]]</p>
								<p style="font-size:20px; font-weight:bold; margin-bottom: 0px; color:red" data-th-text="${#numbers.formatInteger(list.productPrice, 3, 'COMMA') + '원'}"></p>
								<div>상품 리뷰([[${list.reviewCount}]])</div>
								<div class="star-parent">
									<div class="star-fill" th:style="'width: ' + ${list.reviewStarPoint} + '%;'">
										<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
									</div>
									<div class="star-base">
										<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
									</div>
								</div>
							</div>					
						</div>
					</th:block>
				</div>
				
			</div>
		</div>
		<div class="d-block">
		<div class="d-flex justify-content-center mb-4">
				<div th:replace="~{/include/product-paging :: product-paging}"></div>			
			</div>
		</div>
			
	</div>
	<div th:replace="~{/include/footer :: footer}"></div>
	<script th:src="@{/js/mic.js}"></script>
	<script th:inline="javascript">
	
	/*<![CDATA[*/
    var cList = /*[[${categoryList}]]*/
    cId = /*[[${categoryId}]]*/
    /*]]>*/
	pList =/*[[${productList}]]*/
	test = document.querySelector(`.a${cId}`);
    if(test){
	    test.style.color="red";
	    test.style.fontWeight="bold";    	
    }
    showDownCategory(cId, 2);
	
	function goProductDetail(id, groupId){
		let tag = document.createElement('form');
		
		tag.setAttribute('method', 'get');
		tag.setAttribute('action', `/product/${id}/${groupId}`);
		document.body.appendChild(tag);
		tag.submit(); 
	}
	
	function showDownCategory(categoryId, lv){
		console.log(categoryId, lv);
		var showBtn = document.querySelector(`.show-btn${categoryId}`);
		var hiddenBtn = document.querySelector(`.hidden-btn${categoryId}`);
		var lbody = document.querySelector(`.list${categoryId}`);
		showBtn.style.display = "none";
		hiddenBtn.style.display = "inline";
		var frame = `<ul class="down-ul${categoryId}-lv${lv}"></ul>`;
		lbody.innerHTML += frame;
		var mbody = document.querySelector(`.down-ul${categoryId}-lv${lv}`);
		
		cList.forEach(list => {
			if(list.categoryPrId == categoryId){
				var span = document.createElement('span');
				var category = `
						<li class="list${list.categoryId} font-s-13">
							<a class="a${list.categoryId}" href="/category/${list.categoryId}" style="color: black">${list.categoryNm}
								${list.isLeaf == 0 ?  
									`<a class="show-btn${list.categoryId} text-secondary-emphasis" onclick="showDownCategory(${list.categoryId}, ${list.lv})"> 
									 	<img style="width:10px" src="/assets/common/angle-down-solid.svg"></img>
									 </a>
									 <a class="hidden-btn${list.categoryId}" style="display:none" onclick="hideDownCategory(${list.categoryId}, ${list.lv})">
										<img style="width:10px" src="/assets/common/angle-up-solid.svg"></img>
									</a>
									 `
									: ``
								}
									
							</a>
						</li> 
				`
				mbody.innerHTML += category;
				for (let j=0; j<list.lv-1; j++){
					span.innerHTML += '&nbsp';
				}
				const tag = document.querySelector(`.list${list.categoryId}`);		
				tag.prepend(span);
			}
		});
		
		
	}
	
	function hideDownCategory(categoryId, lv){
		var showBtn = document.querySelector(`.show-btn${categoryId}`);
		var hiddenBtn = document.querySelector(`.hidden-btn${categoryId}`);
		var downUl = document.querySelector(`.down-ul${categoryId}-lv${lv}`);
		showBtn.style.display = "inline";
		hiddenBtn.style.display = "none";
		downUl.remove();
		
	}
</script>
</body>

</html>