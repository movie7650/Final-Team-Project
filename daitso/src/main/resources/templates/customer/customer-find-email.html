<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="include/header :: header">
<title>아이디(이메일) 찾기</title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WJB8ZT4ELE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WJB8ZT4ELE');
</script>
</head>
<body>
<div th:replace="include/body-header :: bodyHeader"></div>
<div id="customer-find-container">
	<div id="customer-find-box">
		<div id="customer-find-title">계정정보 찾기</div>
		<div style="display:flex; text-align:center; margin-top:30px; font-size: 16px; font-weight: 600;">
			<div id="customer-find-email-title"><a th:href="@{/customer/find/email}" style="color: black; text-decoration:none;">아이디(이메일) 찾기</a></div>
			<div id="customer-find-pw-title"><a th:href="@{/customer/find/pw}" style="color:#555555; text-decoration:none;">비밀번호 찾기</a></div>
		</div>
		<div style="margin-top:30px; padding: 30px;">
			<div id="customer-find-email-container">
				<div style="display:flex; border-top: 2px solid #CECECE;">	
					<div class="customer-find-text">이름</div>
					<div class="customer-find-input"><input type="text" id="customer-name"></div>
				</div>
				<div style="display:flex;">	
					<div class="customer-find-text" style="display: flex; align-items: center">
						<div>등록된 휴대폰 번호</div>
					</div>
					<div class="customer-find-input">
						<div style="display:flex;">
							<input id="customer-telno" type="text">
							<div id="customer-find-email-send-btn" onclick="sendMessage()">인증번호 전송</div>
							<div 
								 id="customer-find-email-telno-error"
								 style="font-size: 14px; color: red; line-height: 30px; margin-left: 10px; display:none;">휴대폰 번호를 입력해주세요.</div>
						</div>
						<div id="check-randdom-num" style="margin-top: 10px; display: none;">
							<input type="text" id="customer-random-num" maxlength="6">
							<div id="customer-find-email-send-btn" onclick="checkRandomNum()">인증번호 확인</div>
						</div>
						<div style="font-size: 14px; margin-top: 5px; color: red; display:none;" id="customer-find-error">인증번호가 일치하지 않습니다.</div>
					</div>
				</div>
			</div>
			<div id="customer-email-text">
				<div style="font-size:15px;font-weight: 600;"><span id="customer-name-text"></span>님의 아이디입니다.</div>
				<div class="customer-find-pw-email-text" style="margin-top: 15px;">개인계정: <span id="customer-email-show-text"></span></div>
				<div style="font-size:15px;font-weight: 600; margin-top: 30px;">
					<a th:href="@{/customer/login}" style="text-decoration: none; color: #256B04;">로그인 하러가기</a>
				</div>
			</div>
			<div id="customer-no-email-text">
				<div class="customer-find-pw-email-text">개인계정이 존재하지 않습니다.</div>
				<div style="font-size:15px;font-weight: 600; margin-top: 15px;">
					<a th:href="@{/customer/sign-up}" style="text-decoration: none; color: #256B04;">회원가입 하러가기</a>
				</div>
			</div>
		</div>
	</div>
</div>
<div th:replace="include/footer :: footer"></div>
</body>
<script th:inline="javascript">
	
	const name = document.getElementById("customer-name");
	const telno = document.getElementById("customer-telno");
	
	const nameText = document.getElementById("customer-name-text");
	const emailText = document.getElementById("customer-email-show-text");
	
	const sendBtn = document.getElementById("customer-find-email-send-btn");
	const checkNum = document.getElementById("check-randdom-num");
	const num = document.getElementById("customer-random-num");
	const error = document.getElementById("customer-find-error");
	var randomNum = "";
	
	function sendMessage() {
		if(!telno.value) {
			document.getElementById("customer-find-email-telno-error").style.display = 'block';
		} else {
			document.getElementById("customer-find-email-telno-error").style.display = 'none';
			fetch( window.location.origin + "/customer/send-message" , {
			    method: "POST",
			    headers: { 
			        "Content-Type": "application/json",
			        "X-CSRF-TOKEN": [[${_csrf.token}]]
			    },
			    body: JSON.stringify({
			        telno: telno.value
			    }),
			})
			.then((res) => {
				return res.json();
			})
			.then((data) => {
				randomNum = data;
				sendBtn.style.display = 'none';
				telno.disabled = 'true'
				checkNum.style.display = 'flex';
			});		
		}
	}
	
	function checkRandomNum() {
		if(num.value == randomNum){
			fetch( window.location.origin + "/customer/email/"  + telno.value, {
			    method: "GET",
			    headers: { 
			        "Content-Type": "application/json",
			    },
			})
			.then((res) => {
				return res.json();
			})
			.then((data) => {
				if(!data.customerEmail) {
					document.getElementById("customer-find-email-container").style.display = 'none';
					document.getElementById("customer-no-email-text").style.display = 'block';
				} else {
					document.getElementById("customer-find-email-container").style.display = 'none';
					document.getElementById("customer-email-text").style.display = 'block';
					nameText.innerText = name.value;
					emailText.innerText = data.customerEmail;	
				}
			});	
		} else {
			error.style.display = 'block';
		}
	}

</script>
</html>