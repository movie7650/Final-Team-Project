<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{/include/bs-header :: bsHeader}"></head>
<!--
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>  
 -->
<body>
<div th:replace="~{/include/body-header :: bodyHeader}"></div>
<div class="container" style="max-width: 1200px">
        <div class="row">
            <div class="col" style="z-index: 1">
                <!-- 상품 등록 모달을 열기 위한 버튼 -->
                <button class="btn btn-primary float-right" style="background-color: #39594e" data-bs-toggle="modal" data-bs-target="#registerModal" type="button">+등록</button>
            </div>
        </div>
        <hr class="my-4">
        <div>
            <table class="table">
                <thead>
                    <tr>
                        <th>상품 코드</th>
                        <th>상품명</th>
                        <th>사이즈</th>
                        <th>색상</th>
                        <th>기타</th>
                        <th>수량</th>
                        <th>이미지</th>
                        <th></th>
                    </tr>
                </thead>
				<tbody>
					<tr th:each="product : ${products}">
						<td th:text="${product.productCode}"></td>
						<td th:text="${product.productNm}"></td>
						<td th:text="${product.productOptionFirst}"></td>
						<td th:text="${product.productOptionSecond}"></td>
						<td th:text="${product.productOptionThird}"></td>
						<td th:text="${product.productStock}"></td>
						<td><button name="plus" value="${product.prodcutId}" class="btn btn-xs"
								style="background-color: #668663; color: #ffff">더보기</button></td>
						<td>
							<div class="btn-group">
								<button class="btn btn-xs" style="background-color: #39594e; color: #ffff"
								data-bs-toggle="modal" data-bs-target="#updateModal" type="submit">수정</button>
								<form th:action="@{/product/admin/delete(productId=${product.productId})}"
									method="post">
									<button class="btn btn-xs" style="background-color: red; color: #fff" 
									type="submit">삭제</button>
								</form>
							</div>
						</td>
					</tr>
				</tbody>
            </table>
        </div>
</div>
<!-- 상품 등록 모달 -->
<div id="registerModal" class="modal fade" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document" style="max-width: 800px;">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">상품 등록</h5>
			</div>
			<form th:action method="post">
				<div class="modal-body">
					<div class="row mb-3">
						<label form="categoryId" class="col-sm-2 col-form-label">상위
							카테고리</label>
						<div class="col-sm-10">
							<select id="categoryId" name="categoryId"
								onchange="getSubCategories(this.value)">
								<option value="">전체</option>
								<option th:each="category : ${categories}"
									th:value="${category.categoryId}"
									th:text="${category.categoryNm}"></option>
							</select>
						</div>
					</div>

					<div class="row mb-3">
						<label form="subCategoryId" class="col-sm-2 col-form-label">하위
							카테고리</label>
						<div class="col-sm-10">
							<select id="subCategoryId" name="subCategoryId">
								<option value="">전체</option>
							</select>
						</div>
					</div>

					<div class="row mb-3">
						<label form="productNm" class="col-sm-2 col-form-label">상품명</label>
						<div class="col-sm-10">
							<input type="text" id="productNm" name="productNm">
						</div>
					</div>

					<div class="row mb-3">
						<label form="productContent" class="col-sm-2 col-form-label">상품
							상세내용</label>
						<div class="col-sm-10">
							<textarea id="productContent" name="productContent"
								style="height: 200px; width: 510px"></textarea>
						</div>
					</div>

					<div class="row mb-3">
						<label form="productOptionFirst" class="col-sm-2 col-form-label">사이즈</label>
						<div class="col-sm-10">
							<input type="text" id="productOptionFirst"
								name="productOptionFirst">
						</div>
					</div>

					<div class="row mb-3">
						<label form="productOptionSecond" class="col-sm-2 col-form-label">색상</label>
						<div class="col-sm-10">
							<input type="text" id="productOptionSecond"
								name="productOptionSecond">
						</div>
					</div>

					<div class="row mb-3">
						<label form="productOptionThird" class="col-sm-2 col-form-label">기타</label>
						<div class="col-sm-10">
							<input type="text" id="productOptionThird"
								name="productOptionThird">
						</div>
					</div>

					<div class="row mb-3">
						<label form="productPrice" class="col-sm-2 col-form-label">가격</label>
						<div class="col-sm-10">
							<input type="number" id="productPrice" name="productPrice">
						</div>
					</div>

					<div class="row mb-3">
						<label form="productStock" class="col-sm-2 col-form-label">수량</label>
						<div class="col-sm-10">
							<input type="number" id="productStock" name="productStock">
						</div>
					</div>

					<div class="row mb-3">
						<label form="productImageFirst" class="col-sm-2 col-form-label">상품
							이미지</label>
						<div class="col-sm-10">
							<input type="file" id="productImageFirst"
								name="productImageFirst">
						</div>
					</div>

					<div class="modal-footer">
						<!--
									<button type="button" class="btn btn-secondary"	data-dismiss="modal">닫기</button>
									<button type="submit" class="btn btn-primary">저장</button>
								 -->
						<button class="btn btn-primary" onclick="submitForm()"
							style="background-color: #668663"
							th:onclick="|location.href='@{/product/admin)}'|"
							type="submit">저장</button>
						<button class="btn btn-secondary"
							th:onclick="|location.href='@{/product/admin}'|" type="button">닫기</button>
					</div>

				</div>
			</form>
		</div>
	</div>
</div>
<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<!-- 상품 수정 모달 -->
	<div id="updateModal" class="modal fade" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document" style="max-width: 800px;">
			<div class="modal-content">
				<form th:action method="post">
					<div class="modal-header">
						<h5 class="modal-title">상품 수정</h5>
					</div>
					<div class="modal-body">
						<div class="row mb-3">
							<label form="productPrice" class="col-sm-2 col-form-label">가격</label>
							<div class="col-sm-10">
								<input type="number" id="productPrice" name="productPrice">
							</div>
						</div>

						<div class="row mb-3">
							<label form="productStock" class="col-sm-2 col-form-label">수량</label>
							<div class="col-sm-10">
								<input type="number" id="productStock" name="productStock">
							</div>
						</div>

						<div class="modal-footer">
							<button class="btn btn-primary" style="background-color: #668663"
								type="submit" th:onclick="|location.href='@{/product/update}'|">저장</button>
							<button class="btn btn-secondary"
							th:onclick="|location.href='@{/product/admin}'|" type="button">닫기</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
    // 하위 카테고리를 가져오는 함수
    function getSubCategories(categoryId) {
        var subCategorySelect = document.getElementById("subCategoryId");
        subCategorySelect.innerHTML = '<option value="">전체</option>';   
        if (categoryId !== "") {
            fetch("/product/subCategories/" + categoryId)
                .then(response => response.json())
                .then(data => {
                    data.forEach(subCategory => {
                        var option = document.createElement("option");
                        option.value = subCategory.categoryId;
                        option.textContent = subCategory.categoryNm;
                        subCategorySelect.appendChild(option);
                    });
                });
        }
    }
	</script>
<div th:replace="~{/include/footer :: footer}"></div>
</body>
</html>
