<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.daitso.purchase.repository.IPurchaseRepository">
<select id="selectAllOrderProduct" parameterType="int" resultType="com.example.daitso.purchase.model.PurchaseCheck">
	SELECT purchase_count					AS	"purchaseCount",
		   REGEXP_REPLACE(REVERSE(REGEXP_REPLACE(REVERSE(TO_CHAR(purchase_price)), '(\d{3})','\1,')), '^,','')					AS	"purchasePrice",
		   cc.common_code_nm				AS	"purchaseDv",
		   REGEXP_REPLACE(REVERSE(REGEXP_REPLACE(REVERSE(TO_CHAR(purchase_price * purchase_count)), '(\d{3})','\1,')), '^,','')	AS "totalCost",
		   product_nm						AS 	"productNm",
		   purchase_num						AS	"purchaseNum"
		   
   	  FROM purchase pur, product p, common_code cc
   	 WHERE customer_id=#{customerId} 
   	   AND pur.product_id = p.product_id
   	   AND pur.purchase_dv = cc.common_code_id
  ORDER BY purchase_id DESC
</select>



<select id="selectAllPurchaseList" resultType="com.example.daitso.purchase.model.PurchaseList">
    SELECT p.purchase_id     AS  "purchaseId",
           r.product_nm      AS  "productNm",
           c.customer_nm     AS  "customerNm",
	       p.purchase_num	 AS  "purchaseNum",
	       p.create_dt       AS  "createDt",
           d.common_code_id  AS  "commonCodeId",
           d.common_code_nm  AS  "commonCodeNm"
      FROM purchase p
	  JOIN customer c ON p.customer_id = c.customer_id 
      JOIN common_code d ON p.purchase_dv = d.common_code_id
      JOIN product r ON r.product_id = p.product_id
  ORDER BY p.create_dt
<!-- 	 WHERE purchase_dv = #{purchaseDv} -->
</select>

<update id="changePurchaseStatus" parameterType="com.example.daitso.purchase.model.PurchaseList">
    UPDATE purchase
       SET purchase_dv = #{commonCodeId}
     WHERE purchase_id = #{purchaseId}
</update>

</mapper>